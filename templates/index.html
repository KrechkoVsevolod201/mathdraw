<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏–∫ —Ñ—É–Ω–∫—Ü–∏–∏</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        input, select, button { padding: 10px; margin: 8px 0; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; }
        input { width: 300px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        .error { color: #dc3545; margin: 15px 0; padding: 10px; background: #f8d7da; border-radius: 5px; }
        .plot { margin: 25px 0; text-align: center; background: white; padding: 15px; border-radius: 8px; }
        .download-buttons { margin: 20px 0; display: flex; gap: 15px; justify-content: center; }
        .download-buttons button { background: #28a745; padding: 12px 20px; }
        .download-buttons button:hover { background: #218838; }
        .form-group { margin: 15px 0; }
        .hidden { display: none; }
        small { color: #666; font-style: italic; display: block; margin-top: 5px; }
        h1 { color: #333; text-align: center; margin-bottom: 25px; }
        label { font-weight: bold; color: #555; }
        .form-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .form-column { flex: 1; min-width: 250px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π</h1>
        
        <form method="POST" action="/plot" id="plotForm">
            <div class="form-row">
                <div class="form-column">
                    <div class="form-group">
                        <label>–¢–∏–ø —Ñ—É–Ω–∫—Ü–∏–∏:</label><br>
                        <select name="function_type" id="functionType">
                            <option value="x" {% if function_type == 'x' %}selected{% endif %}>y = f(x)</option>
                            <option value="xy" {% if function_type == 'xy' %}selected{% endif %}>z = f(x, y)</option>
                            <option value="xyz" {% if function_type == 'xyz' %}selected{% endif %}>w = f(x, y, z)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</label><br>
                        <select name="resolution">
                            <option value="small" {% if resolution == 'small' %}selected{% endif %}>–ú–∞–ª–µ–Ω—å–∫–æ–µ (6x4)</option>
                            <option value="medium" {% if resolution == 'medium' %}selected{% endif %}>–°—Ä–µ–¥–Ω–µ–µ (8x6)</option>
                            <option value="large" {% if resolution == 'large' %}selected{% endif %}>–ë–æ–ª—å—à–æ–µ (12x8)</option>
                            <option value="4k" {% if resolution == '4k' %}selected{% endif %}>4K (16x9)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-column">
                    <div class="form-group">
                        <label>–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</label><br>
                        <select name="transform">
                            <option value="none" {% if transform == 'none' %}selected{% endif %}>–ë–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è</option>
                            <option value="abs" {% if transform == 'abs' %}selected{% endif %}>–ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (abs)</option>
                            <option value="angle" {% if transform == 'angle' %}selected{% endif %}>–§–∞–∑–∞ (angle)</option>
                            <option value="real" {% if transform == 'real' %}selected{% endif %}>–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (real)</option>
                            <option value="imag" {% if transform == 'imag' %}selected{% endif %}>–ú–Ω–∏–º–∞—è —á–∞—Å—Ç—å (imag)</option>
                            <option value="log" {% if transform == 'log' %}selected{% endif %}>–õ–æ–≥–∞—Ä–∏—Ñ–º (log)</option>
                            <option value="log10" {% if transform == 'log10' %}selected{% endif %}>–õ–æ–≥–∞—Ä–∏—Ñ–º –ø–æ base 10 (log10)</option>
                            <option value="fft" {% if transform == 'fft' %}selected{% endif %}>–§—É—Ä—å–µ-—Å–ø–µ–∫—Ç—Ä (FFT)</option>
                            <option value="fft_phase" {% if transform == 'fft_phase' %}selected{% endif %}>–§–∞–∑–∞ –§—É—Ä—å–µ (FFT phase)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:</label><br>
                        <select name="color">
                            <option value="blue" {% if color == 'blue' %}selected{% endif %}>–°–∏–Ω–∏–π</option>
                            <option value="red" {% if color == 'red' %}selected{% endif %}>–ö—Ä–∞—Å–Ω—ã–π</option>
                            <option value="green" {% if color == 'green' %}selected{% endif %}>–ó–µ–ª–µ–Ω—ã–π</option>
                            <option value="orange" {% if color == 'orange' %}selected{% endif %}>–û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                            <option value="purple" {% if color == 'purple' %}selected{% endif %}>–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                            <option value="black" {% if color == 'black' %}selected{% endif %}>–ß–µ—Ä–Ω—ã–π</option>
                            <option value="rainbow" {% if color == 'rainbow' %}selected{% endif %}>–†–∞–¥—É–≥–∞</option>
                            <option value="hot" {% if color == 'hot' %}selected{% endif %}>–ì–æ—Ä—è—á–∏–π</option>
                            <option value="cool" {% if color == 'cool' %}selected{% endif %}>–•–æ–ª–æ–¥–Ω—ã–π</option>
                            <option value="viridis" {% if color == 'viridis' %}selected{% endif %}>Viridis</option>
                            <option value="plasma" {% if color == 'plasma' %}selected{% endif %}>Plasma</option>
                            <option value="magma" {% if color == 'magma' %}selected{% endif %}>Magma</option>
                            <option value="jet" {% if color == 'jet' %}selected{% endif %}>Jet</option>
                            <option value="inferno" {% if color == 'inferno' %}selected{% endif %}>Inferno</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label id="equationLabel">–£—Ä–∞–≤–Ω–µ–Ω–∏–µ:</label><br>
                <input type="text" name="equation" value="{{ equation or '' }}" placeholder="–í–≤–µ–¥–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ" id="equationInput">
                <div id="xExamples" class="{% if function_type != 'x' %}hidden{% endif %}">
                    <small>–ü—Ä–∏–º–µ—Ä—ã: x**2, sin(x), 2*x+1, exp(-x**2), fft(sin(x)), abs(fft(sin(x)))</small>
                </div>
                <div id="xyExamples" class="{% if function_type != 'xy' %}hidden{% endif %}">
                    <small>–ü—Ä–∏–º–µ—Ä—ã: x**2 + y**2, sin(x)*cos(y), exp(-(x**2+y**2)), fft2(sin(x)*cos(y))</small>
                </div>
                <div id="xyzExamples" class="{% if function_type != 'xyz' %}hidden{% endif %}">
                    <small>–ü—Ä–∏–º–µ—Ä—ã: x**2 + y**2 + z**2, sin(x)+cos(y)+tan(z)</small>
                </div>
            </div>
            
            <button type="submit">üìà –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
        </form>

        {% if error %}
            <div class="error">
                <strong>‚ö†Ô∏è –û—à–∏–±–∫–∞:</strong> {{ error }}
            </div>
        {% endif %}

        {% if plot_data %}
            <div class="plot">
                <img src="data:image/png;base64,{{ plot_data }}" alt="–ì—Ä–∞—Ñ–∏–∫ —Ñ—É–Ω–∫—Ü–∏–∏" style="max-width: 100%; height: auto;">
            </div>
            
            <div class="download-buttons">
                <form method="POST" action="/download">
                    <input type="hidden" name="equation" value="{{ equation }}">
                    <input type="hidden" name="color" value="{{ color }}">
                    <input type="hidden" name="function_type" value="{{ function_type }}">
                    <input type="hidden" name="transform" value="{{ transform }}">
                    <input type="hidden" name="resolution" value="{{ resolution }}">
                    <input type="hidden" name="format" value="png">
                    <button type="submit">üíæ –°–∫–∞—á–∞—Ç—å PNG</button>
                </form>
                
                <form method="POST" action="/download">
                    <input type="hidden" name="equation" value="{{ equation }}">
                    <input type="hidden" name="color" value="{{ color }}">
                    <input type="hidden" name="function_type" value="{{ function_type }}">
                    <input type="hidden" name="transform" value="{{ transform }}">
                    <input type="hidden" name="resolution" value="{{ resolution }}">
                    <input type="hidden" name="format" value="svg">
                    <button type="submit">üíæ –°–∫–∞—á–∞—Ç—å SVG</button>
                </form>
            </div>
        {% endif %}
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ—É–Ω–∫—Ü–∏–∏
        function updateFunctionType() {
            const functionType = document.getElementById('functionType').value;
            const xExamples = document.getElementById('xExamples');
            const xyExamples = document.getElementById('xyExamples');
            const xyzExamples = document.getElementById('xyzExamples');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã
            xExamples.classList.add('hidden');
            xyExamples.classList.add('hidden');
            xyzExamples.classList.add('hidden');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
            if (functionType === 'x') {
                xExamples.classList.remove('hidden');
            } else if (functionType === 'xy') {
                xyExamples.classList.remove('hidden');
            } else if (functionType === 'xyz') {
                xyzExamples.classList.remove('hidden');
            }
        }

        document.getElementById('functionType').addEventListener('change', updateFunctionType);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', updateFunctionType);
    </script>
</body>
</html>